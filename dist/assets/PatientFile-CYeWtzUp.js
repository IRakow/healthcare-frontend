import{e as ee,u as se,r,f as te,s as o,j as e,A as m,B as v,h as ae,C as i,U as ie,T as ne,i as le,k as h,l as p,d as re,P as F,m as x,b as I,F as u,n as q,o as ce,p as de}from"./index-VSbfBWhb.js";function me(){var k,C,T,M,O,U;const{patientId:c}=ee(),y=se(),[L,Y]=r.useState(!0),[d,B]=r.useState(null),[b,H]=r.useState([]),[N,z]=r.useState([]),[f,J]=r.useState([]),[l,R]=r.useState(null),[w,V]=r.useState([]),[$,S]=r.useState("timeline"),[g,_]=r.useState(""),[D,A]=r.useState(!1),[a,G]=r.useState(null);r.useEffect(()=>{c&&P()},[c]);async function P(){try{const s=await te(c);G(s);const{data:t}=await o.from("users").select("*").eq("id",c).single();if(t&&B(t),s.canSeeTimeline){const{data:n}=await o.from("patient_timeline_events").select("*").eq("patient_id",c).order("created_at",{ascending:!1});H(n||[])}if(s.canSeeMeds){const{data:n}=await o.from("medications").select("*").eq("patient_id",c).order("created_at",{ascending:!1});z(n||[]);const{data:j}=await o.from("patient_intake").select("*").eq("patient_id",c).maybeSingle();R(j)}if(s.canSeeAppointments){const{data:n}=await o.from("appointments").select(`
            *,
            provider:users!appointments_provider_id_fkey(full_name)
          `).eq("patient_id",c).order("date",{ascending:!1}).order("time",{ascending:!1});J(n||[])}if(s.canSeeUploads){const{data:n}=await o.from("uploads").select("*").eq("patient_id",c).order("created_at",{ascending:!1});V(n||[])}}catch(s){console.error("Error loading patient data:",s)}finally{Y(!1)}}async function K(){var s;if(!(!g.trim()||!c)){A(!0);try{const{error:t}=await o.from("patient_timeline_events").insert({patient_id:c,type:"visit",label:"SOAP Note",data:{note:g.trim(),date:new Date().toISOString(),provider_id:(s=(await o.auth.getUser()).data.user)==null?void 0:s.id}});if(t)throw t;_(""),await P(),S("timeline")}catch(t){console.error("Error saving SOAP note:",t),alert("Failed to save SOAP note")}finally{A(!1)}}}const Q=s=>({visit:I,med:F,upload:q,ai:de,update:u,vitals:ce,lab:u})[s]||u,W=s=>({visit:"text-blue-600 bg-blue-50",med:"text-green-600 bg-green-50",upload:"text-purple-600 bg-purple-50",ai:"text-indigo-600 bg-indigo-50",update:"text-gray-600 bg-gray-50",vitals:"text-red-600 bg-red-50",lab:"text-yellow-600 bg-yellow-50"})[s]||"text-gray-600 bg-gray-50",X=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),Z=s=>{if(!s)return"N/A";const t=new Date(s),n=new Date;let j=n.getFullYear()-t.getFullYear();const E=n.getMonth()-t.getMonth();return(E<0||E===0&&n.getDate()<t.getDate())&&j--,j};return L?e.jsx("div",{className:"p-6 max-w-screen-xl mx-auto",children:e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading patient information..."})}):d?e.jsxs("div",{className:"p-6 max-w-screen-xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>y("/provider/dashboard"),className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Back to Dashboard"]})}),e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:d.full_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mt-1",children:[e.jsx("span",{children:d.email}),d.phone&&e.jsxs("span",{children:["â€¢ ",d.phone]}),e.jsxs("span",{children:["â€¢ Age: ",Z(d.date_of_birth)]})]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[e.jsxs("p",{children:["Patient ID: ",d.id.slice(0,8),"..."]}),e.jsxs("p",{children:["Member since: ",new Date(d.created_at).toLocaleDateString()]})]})]}),l&&(a==null?void 0:a.canSeeMeds)&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Conditions"}),e.jsx("p",{className:"text-lg font-semibold",children:((k=l.conditions)==null?void 0:k.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Allergies"}),e.jsx("p",{className:"text-lg font-semibold",children:((C=l.allergies)==null?void 0:C.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Medications"}),e.jsx("p",{className:"text-lg font-semibold",children:N.filter(s=>s.is_active).length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Appointments"}),e.jsx("p",{className:"text-lg font-semibold",children:f.length})]})]})]}),(a==null?void 0:a.isOwner)&&e.jsxs(i,{title:"Add SOAP Note",children:[e.jsx("textarea",{value:g,onChange:s=>_(s.target.value),placeholder:"Enter SOAP note (Subjective, Objective, Assessment, Plan)...",className:"w-full border rounded p-2 text-sm",rows:5}),e.jsx(v,{onClick:K,disabled:!g.trim()||D,className:"mt-2",children:D?"Saving...":"Save Note"})]}),e.jsxs(ne,{value:$,onValueChange:S,children:[e.jsxs(le,{className:"grid w-full grid-cols-5",children:[e.jsx(h,{value:"timeline",children:"Timeline"}),e.jsx(h,{value:"medications",children:"Medications"}),e.jsx(h,{value:"appointments",children:"Appointments"}),e.jsx(h,{value:"medical-history",children:"Medical History"}),e.jsx(h,{value:"documents",children:"Documents"})]}),e.jsx(p,{value:"timeline",className:"space-y-4",children:a!=null&&a.canSeeTimeline?b.length===0?e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(re,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No timeline events yet"})]}):b.map(s=>{const t=Q(s.type),n=W(s.type);return e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${n}`,children:e.jsx(t,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:s.label}),e.jsx("span",{className:"text-sm text-gray-500",children:X(s.created_at)})]}),s.data&&e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:e.jsx("pre",{className:"bg-gray-50 p-2 rounded overflow-auto",children:JSON.stringify(s.data,null,2)})})]})]})},s.id)}):e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(m,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"You don't have permission to view timeline events"})]})}),e.jsx(p,{value:"medications",className:"space-y-4",children:a!=null&&a.canSeeMeds?N.length===0?e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(F,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No medications recorded"})]}):N.map(s=>e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1 mt-1",children:[e.jsxs("p",{children:["Strength: ",s.strength]}),e.jsxs("p",{children:["Dosage: ",s.dosage]}),e.jsxs("p",{children:["Frequency: ",s.frequency]})]})]}),e.jsx(x,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})]})},s.id)):e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(m,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"You don't have permission to view medications"})]})}),e.jsx(p,{value:"appointments",className:"space-y-4",children:a!=null&&a.canSeeAppointments?f.length===0?e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(I,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No appointments recorded"})]}):f.map(s=>{var t;return e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium",children:[new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})," at ",s.time]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.reason," â€¢ ",s.type," â€¢ with ",((t=s.provider)==null?void 0:t.full_name)||"Provider"]})]}),e.jsx(x,{children:s.status})]})},s.id)}):e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(m,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"You don't have permission to view appointments"})]})}),e.jsx(p,{value:"medical-history",className:"space-y-6",children:a!=null&&a.canSeeMeds?l?e.jsxs(e.Fragment,{children:[e.jsxs(i,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Medical Conditions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:((T=l.conditions)==null?void 0:T.length)>0?l.conditions.map((s,t)=>e.jsx(x,{variant:"secondary",children:s},t)):e.jsx("p",{className:"text-gray-500",children:"None reported"})})]}),e.jsxs(i,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Allergies"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:((M=l.allergies)==null?void 0:M.length)>0?l.allergies.map((s,t)=>e.jsx(x,{variant:"destructive",children:s},t)):e.jsx("p",{className:"text-gray-500",children:"None reported"})})]}),e.jsxs(i,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Previous Surgeries"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:((O=l.surgeries)==null?void 0:O.length)>0?l.surgeries.map((s,t)=>e.jsx(x,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-gray-500",children:"None reported"})})]}),e.jsxs(i,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Family History"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:((U=l.family_history)==null?void 0:U.length)>0?l.family_history.map((s,t)=>e.jsx(x,{variant:"outline",children:s},t)):e.jsx("p",{className:"text-gray-500",children:"None reported"})})]})]}):e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(u,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No medical history recorded"})]}):e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(m,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"You don't have permission to view medical history"})]})}),e.jsx(p,{value:"documents",className:"space-y-4",children:a!=null&&a.canSeeUploads?w.length===0?e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(q,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No documents uploaded"})]}):e.jsx(i,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Uploaded Documents"}),e.jsx("div",{className:"space-y-3",children:w.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“„"}),e.jsx("span",{children:s.filename})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()})]},t))})]})}):e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(m,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"You don't have permission to view documents"})]})})]})]}):e.jsx("div",{className:"p-6 max-w-screen-xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(m,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Patient not found"}),e.jsx(v,{onClick:()=>y("/provider/dashboard"),className:"mt-4",children:"Back to Dashboard"})]})})}export{me as default};
