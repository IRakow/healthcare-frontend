import{r as i,x as b,s as a,j as e,C as _,F as d,b as v,m as I,D as C,y as F,B as h}from"./index-BshQ_n5L.js";function S(){const[r,m]=i.useState([]),[u,p]=i.useState(!0),[x,g]=i.useState(null),o=b(),f=(o==null?void 0:o.primary_color)||"#3B82F6";i.useEffect(()=>{j()},[]);async function j(){try{const{data:{user:s}}=await a.auth.getUser();if(!s)return;const{data:t}=await a.from("users").select("employer_id").eq("id",s.id).single();if(t!=null&&t.employer_id){const{data:n}=await a.from("invoices").select("*").eq("employer_id",t.employer_id).order("month",{ascending:!1});m(n||[])}}catch(s){console.error("Error loading invoices:",s)}finally{p(!1)}}async function y(s){g(s);try{const{data:{user:t}}=await a.auth.getUser();t&&await a.from("audit_logs").insert({user_id:t.id,action:"invoice_pdf_generate",target:s});const l=await(await fetch("https://dhycdcugbjchktvqlroz.supabase.co/functions/v1/generate-invoice-pdf",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRoeWNkY3VnYmpjaGt0dnFscm96Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyMTk1MzQsImV4cCI6MjA2ODc5NTUzNH0.DknqvlCCYOSLe3olTMtRA8jAoNMRg17aAesYLuo6TUI"},body:JSON.stringify({invoiceId:s})})).json();l.pdf_url&&(window.open(l.pdf_url,"_blank"),m(r.map(c=>c.id===s?{...c,pdf_url:l.pdf_url}:c)))}catch(t){console.error("Error generating PDF:",t),alert("Failed to generate PDF")}finally{g(null)}}const N=s=>{const[t,n]=s.split("-");return new Date(parseInt(t),parseInt(n)-1).toLocaleDateString("en-US",{month:"long",year:"numeric"})},w=s=>{switch(s){case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return u?e.jsx("div",{className:"p-6 max-w-screen-xl mx-auto",children:e.jsx("div",{className:"text-center py-12",children:"Loading invoices..."})}):e.jsxs("div",{className:"p-6 max-w-screen-xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Invoices"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",r.length," invoices"]})]}),r.length===0?e.jsxs(_,{className:"p-8 text-center",children:[e.jsx(d,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No invoices yet"})]}):e.jsx("div",{className:"grid gap-4",children:r.map(s=>e.jsx("div",{style:{borderColor:f},className:"rounded-lg border p-6 bg-white hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(v,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold",children:N(s.month)}),e.jsx(I,{className:w(s.status),children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-semibold",children:["$",s.total_amount.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Patients:"}),e.jsx("span",{className:"font-semibold",children:s.patient_count})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Created: ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.pdf_url?e.jsxs("a",{href:s.pdf_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:[e.jsx(F,{className:"h-4 w-4"}),"Download PDF"]}):e.jsx(h,{onClick:()=>y(s.id),disabled:x===s.id,variant:"secondary",children:x===s.id?e.jsx(e.Fragment,{children:"Generating..."}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Generate PDF"]})}),e.jsxs(h,{onClick:async()=>{const{data:{user:t}}=await a.auth.getUser();t&&await a.from("audit_logs").insert({user_id:t.id,action:"invoice_pdf_download",target:s.id}),window.open(`https://dhycdcugbjchktvqlroz.supabase.co/functions/v1/invoice-pdf/${s.id}`,"_blank")},variant:"outline",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"View PDF"]})]})]})},s.id))})]})}export{S as default};
