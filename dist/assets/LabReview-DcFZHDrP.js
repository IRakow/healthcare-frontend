import{r,s as l,j as e,m as x,C as m,B as c}from"./index-BshQ_n5L.js";function b(){const[i,d]=r.useState([]),[h,p]=r.useState(!0);r.useEffect(()=>{u()},[]);async function u(){try{const{data:a}=await l.from("lab_results").select("*").eq("reviewed",!1).order("date",{descending:!0});d(a||[])}catch(a){console.error("Error loading labs:",a)}finally{p(!1)}}async function f(a){try{const{error:t}=await l.from("lab_results").update({reviewed:!0}).eq("id",a);if(!t){d(i.filter(n=>n.id!==a));const s=i.find(n=>n.id===a);s&&await l.from("patient_timeline_events").insert({patient_id:s.patient_id,type:"lab",label:`Lab Review: ${s.panel}`,data:{lab_id:a,reviewed_by:"provider",reviewed_at:new Date}})}}catch(t){console.error("Error marking lab as reviewed:",t),alert("Failed to mark as reviewed")}}async function j(a){const t=await fetch("/functions/v1/explain-lab",{method:"POST",body:JSON.stringify({panel:a.panel,results:a.results}),headers:{"Content-Type":"application/json"}}),{summary:s}=await t.json();alert(s)}return h?e.jsx("div",{className:"p-6 max-w-screen-lg mx-auto",children:e.jsx("div",{className:"text-center",children:"Loading labs for review..."})}):e.jsxs("div",{className:"p-6 max-w-screen-lg mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-700",children:"ðŸ”¬ Lab Review Queue"}),e.jsxs(x,{variant:"outline",className:"text-lg px-3 py-1",children:[i.length," Pending Review"]})]}),i.length===0?e.jsx(m,{children:e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-600",children:"âœ… All labs have been reviewed!"})})}):i.map((a,t)=>e.jsx(m,{title:`${a.panel} â€” ${a.date}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Patient ID: ",a.patient_id]}),e.jsx(x,{variant:"outline",className:"text-xs",children:"Needs Review"})]}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"pb-1",children:"Test"}),e.jsx("th",{className:"pb-1",children:"Value"}),e.jsx("th",{className:"pb-1",children:"Reference"}),e.jsx("th",{className:"pb-1",children:"Flag"})]})}),e.jsx("tbody",{children:(a.results||[]).map((s,n)=>{const o=s.flag==="high"||s.flag==="low"||s.abnormal;return e.jsxs("tr",{className:`border-b ${o?"bg-red-50":""}`,children:[e.jsx("td",{className:"py-1",children:s.name}),e.jsxs("td",{className:"font-medium",children:[s.value," ",s.unit]}),e.jsx("td",{className:"text-gray-500",children:s.reference}),e.jsx("td",{children:o&&e.jsx("span",{className:"text-red-600 font-medium",children:s.flag||"Abnormal"})})]},n)})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(c,{onClick:()=>f(a.id),className:"bg-green-600 hover:bg-green-700",children:"âœ“ Mark Reviewed"}),e.jsx(c,{onClick:()=>j(a),variant:"outline",children:"ðŸ’¡ AI Explanation"}),e.jsx(c,{onClick:()=>window.location.href=`/provider/patient/${a.patient_id}`,variant:"outline",children:"View Patient"})]})]})},t))]})}export{b as default};
