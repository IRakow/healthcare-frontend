import{r as o,u as E,s as r,j as e,C as c,A as N,a as v,b as h,V as g,B as d,c as T,d as V,U as z,g as P}from"./index-CSQhjnb8.js";function $(){const[n,x]=o.useState([]),[y,w]=o.useState(!0),[b,_]=o.useState(0),[m,C]=o.useState("today"),p=E();o.useEffect(()=>{k()},[]);async function k(){try{const{data:{user:s}}=await r.auth.getUser();if(!s)return;const{data:t,error:a}=await r.from("appointments").select(`
          *,
          patient:users!appointments_patient_id_fkey(
            id,
            full_name,
            email
          )
        `).eq("provider_id",s.id).order("date",{ascending:!0}).order("time",{ascending:!0});if(a)throw a;const l=t||[];x(l);const i=new Date().toISOString().split("T")[0],F=l.filter(f=>f.date===i&&f.status!=="complete");_(F.length)}catch(s){console.error("Error loading appointments:",s)}finally{w(!1)}}async function j(s,t){try{const{error:a}=await r.from("appointments").update({status:t}).eq("id",s);if(a)throw a;x(n.map(i=>i.id===s?{...i,status:t}:i));const l=n.find(i=>i.id===s);l&&await r.from("patient_timeline_events").insert({patient_id:l.patient_id,type:"visit",label:`Appointment ${t.replace("_"," ")}`,data:{appointment_id:s,status:t}})}catch(a){console.error("Error updating appointment:",a),alert("Failed to update appointment status")}}async function S(s){try{const t=P(s),{error:a}=await r.from("appointments").update({status:"in_progress",video_url:t}).eq("id",s);if(a)throw a;x(n.map(i=>i.id===s?{...i,status:"in_progress",video_url:t}:i)),p(`/provider/telemed/${s}`);const l=n.find(i=>i.id===s);l&&await r.from("patient_timeline_events").insert({patient_id:l.patient_id,type:"visit",label:"Video appointment started",data:{appointment_id:s,video_url:t}})}catch(t){console.error("Error starting video call:",t),alert("Failed to start video call")}}const A=()=>{const s=new Date().toISOString().split("T")[0];switch(m){case"today":return n.filter(t=>t.date===s);case"upcoming":return n.filter(t=>t.date>=s&&t.status!=="complete");case"pending":return n.filter(t=>t.status==="pending");default:return n}},D=s=>{const t={pending:{color:"bg-yellow-100 text-yellow-700",icon:N},in_progress:{color:"bg-blue-100 text-blue-700",icon:g},complete:{color:"bg-green-100 text-green-700",icon:v}},a=t[s]||t.pending,l=a.icon;return e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a.color}`,children:[e.jsx(l,{className:"h-3 w-3"}),s.replace("_"," ")]})};if(y)return e.jsx("div",{className:"p-6 max-w-screen-xl mx-auto",children:e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading appointments..."})});const u=A();return e.jsxs("div",{className:"p-6 max-w-screen-xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Provider Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your appointments and patients"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Today's Appointments"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:b})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold",children:n.filter(s=>s.status==="pending").length})]}),e.jsx(N,{className:"h-8 w-8 text-yellow-500"})]})})}),e.jsx(c,{children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold",children:n.filter(s=>s.status==="in_progress").length})]}),e.jsx(v,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(c,{children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"This Week"}),e.jsx("p",{className:"text-2xl font-bold",children:n.filter(s=>{const t=new Date(s.date),a=new Date,l=new Date(a.getTime()+7*24*60*60*1e3);return t>=a&&t<=l}).length})]}),e.jsx(h,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(c,{children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Telemedicine"}),e.jsx("p",{className:"text-2xl font-bold",children:n.filter(s=>s.type==="telemed").length})]}),e.jsx(g,{className:"h-8 w-8 text-purple-500"})]})})})]}),e.jsx("div",{className:"flex gap-2",children:["today","upcoming","pending","all"].map(s=>e.jsx(d,{variant:m===s?"default":"outline",size:"sm",onClick:()=>C(s),children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),u.length===0?e.jsx(c,{children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(h,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsxs("p",{className:"text-gray-500",children:["No ",m," appointments"]})]})}):e.jsx("div",{className:"space-y-4",children:u.map(s=>{var t,a;return e.jsx(c,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:s.type==="telemed"?e.jsx(g,{className:"h-6 w-6 text-blue-600"}):e.jsx(T,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:((t=s.patient)==null?void 0:t.full_name)||"Patient"}),D(s.status)]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4"}),new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),s.time]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),(a=s.patient)==null?void 0:a.email]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Reason:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.reason})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[s.type==="telemed"&&e.jsx(d,{size:"sm",onClick:()=>S(s.id),children:"Start Video Call"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>j(s.id,"complete"),children:"Mark Complete"})]}),s.status==="in_progress"&&e.jsxs(e.Fragment,{children:[s.video_url&&e.jsx(d,{size:"sm",onClick:()=>p(`/provider/telemed/${s.id}`),children:"Join Video"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>j(s.id,"complete"),children:"End Call"})]}),e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>p(`/provider/patient/${s.patient_id}`),children:"View Patient File"})]})]})})},s.id)})})]})}export{$ as default};
